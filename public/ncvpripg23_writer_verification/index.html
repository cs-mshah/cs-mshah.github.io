

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" />
    <title>Winning the NCVPRIPG23 Challenge on Writer Verification - Manan&#39;s Blog</title><meta name="Description" content="This post outlines the approach I used for NCVPRIPG23&#39;s challenge on writer verification"><meta property="og:url" content="https://cs-mshah.github.io/ncvpripg23_writer_verification/">
  <meta property="og:site_name" content="Manan&#39;s Blog">
  <meta property="og:title" content="Winning the NCVPRIPG23 Challenge on Writer Verification">
  <meta property="og:description" content="This post outlines the approach I used for NCVPRIPG23&#39;s challenge on writer verification">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-07-23T22:21:30+05:30">
    <meta property="article:modified_time" content="2023-07-25T22:21:30+05:30">
    <meta property="article:tag" content="CV">
    <meta property="og:image" content="https://cs-mshah.github.io/android-chrome-192x192.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://cs-mshah.github.io/android-chrome-192x192.png">
  <meta name="twitter:title" content="Winning the NCVPRIPG23 Challenge on Writer Verification">
  <meta name="twitter:description" content="This post outlines the approach I used for NCVPRIPG23&#39;s challenge on writer verification">
      <meta name="twitter:site" content="@cs_mshah">
<meta name="application-name" content="Manan&#39;s Blog">
<meta name="apple-mobile-web-app-title" content="Manan&#39;s Blog">

<meta name="theme-color" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="https://cs-mshah.github.io/ncvpripg23_writer_verification/" /><link rel="prev" href="https://cs-mshah.github.io/cs161_computer_security_notes/" />
<link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/color.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/fontawesome-free/all.min.css">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/animate/animate.min.css">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Winning the NCVPRIPG23 Challenge on Writer Verification",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/cs-mshah.github.io\/ncvpripg23_writer_verification\/"
        },"image": ["https:\/\/cs-mshah.github.io\/android-chrome-192x192.png"],"genre": "posts","keywords": "CV","wordcount":  961 ,
        "url": "https:\/\/cs-mshah.github.io\/ncvpripg23_writer_verification\/","datePublished": "2023-07-23T22:21:30+05:30","dateModified": "2023-07-25T22:21:30+05:30","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "Manan","logo": "https:\/\/cs-mshah.github.io\/android-chrome-192x192.png"},"authors": [{
                        "@type": "Person",
                        "name": "Manan"                    
                    }],"description": "This post outlines the approach I used for NCVPRIPG23's challenge on writer verification"
    }
    </script><script src="//instant.page/5.2.0" defer type="module" integrity="sha384-jnZyxPjiipYXnSU0ygqeac2q7CVYMbh84q0uHVRRxEtvFPiQYbXWUorga2aqZJ0z"></script>
</head>

<body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">
        function setTheme(theme) {document.body.setAttribute('theme', theme); document.documentElement.style.setProperty('color-scheme', theme === 'light' ? 'light' : 'dark'); window.theme = theme;   window.isDark = window.theme !== 'light' }
        function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
        function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
        if (window.localStorage && localStorage.getItem('theme')) {let theme = localStorage.getItem('theme');theme === 'light' || theme === 'dark' || theme === 'black' ? setTheme(theme) : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light')); } else { if ('auto' === 'light' || 'auto' === 'dark' || 'auto' === 'black') setTheme('auto'), saveTheme('auto'); else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');}
        let metaColors = {'light': '#f8f8f8','dark': '#252627','black': '#000000'}
        getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
        window.switchThemeEventSet = new Set()
    </script>
    <div id="back-to-top"></div>
    <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Manan&#39;s Blog"><span class="header-title-pre"><i class='far fa-edit fa-fw'></i></span>Manan&#39;s Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="https://mailchi.mp/26a81bdf8647/personal-blog-sign-up" rel="noopener noreferrer" target="_blank"><i class='fa fa-envelope' aria-hidden='true'></i> Newsletter </a><a class="menu-item" href="/index.xml"><i class='fa fa-rss' aria-hidden='true'></i>  </a><a class="menu-item" href="https://github.com/cs-mshah" title="GitHub" rel="noopener noreferrer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-select" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                    <select class="color-theme-select" id="theme-select-desktop" title="Switch Theme">
                        <option value="light">Light</option>
                        <option value="dark">Dark</option>
                        <option value="black">Black</option>
                        <option value="auto">Auto</option>
                    </select>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Manan&#39;s Blog"><span class="header-title-pre"><i class='far fa-edit fa-fw'></i></span>Manan&#39;s Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="https://mailchi.mp/26a81bdf8647/personal-blog-sign-up" title="" rel="noopener noreferrer" target="_blank"><i class='fa fa-envelope' aria-hidden='true'></i>Newsletter</a><a class="menu-item" href="/index.xml" title=""><i class='fa fa-rss' aria-hidden='true'></i></a><a class="menu-item" href="https://github.com/cs-mshah" title="GitHub" rel="noopener noreferrer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-select" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
                <select class="color-theme-select" id="theme-select-mobile" title="Switch Theme">
                    <option value="light">Light</option>
                    <option value="dark">Dark</option>
                    <option value="black">Black</option>
                    <option value="auto">Auto</option>
                </select>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
            <div class="container"><div class="toc" id="toc-auto">
        <h2 class="toc-title">Contents</h2>
        <div class="toc-content always-active" id="toc-content-auto"><nav id="TableOfContents">
  <ul>
    <li><a href="#the-challenge">The Challenge</a></li>
    <li><a href="#exploratory-data-analysis-eda">Exploratory Data Analysis (EDA)</a></li>
    <li><a href="#model-architecture">Model Architecture</a>
      <ul>
        <li><a href="#the-image-encoder">The Image Encoder</a></li>
        <li><a href="#the-triplet-loss">The Triplet Loss</a></li>
        <li><a href="#training">Training</a></li>
      </ul>
    </li>
    <li><a href="#results-and-conclusions">Results and Conclusions</a></li>
  </ul>
</nav></div>
    </div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC", "true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Winning the NCVPRIPG23 Challenge on Writer Verification</h1><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><span class='author'><span class="author fas fa-user-circle fa-fw"></span><span class='screen-reader-text'>  </span><a href='https://cs-mshah.github.io/authors/manan'>Manan Shah</a></span>
                </span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="23-07-2023">23-07-2023</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime="25-07-2023">25-07-2023</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;961 words&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;5 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#the-challenge">The Challenge</a></li>
    <li><a href="#exploratory-data-analysis-eda">Exploratory Data Analysis (EDA)</a></li>
    <li><a href="#model-architecture">Model Architecture</a>
      <ul>
        <li><a href="#the-image-encoder">The Image Encoder</a></li>
        <li><a href="#the-triplet-loss">The Triplet Loss</a></li>
        <li><a href="#training">Training</a></li>
      </ul>
    </li>
    <li><a href="#results-and-conclusions">Results and Conclusions</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="the-challenge" class="headerLink">
    <a href="#the-challenge" class="header-mark"></a>The Challenge</h2><p>The statement is simple. Given two images of handwritten texts, predict whether they&rsquo;ve been written by the same person or not. This challenge was a part of the <a href="https://vl2g.github.io/challenges/wv2023" target="_blank" rel="noopener noreferrer">8th National Conference on Computer Vision, Pattern Recognition, Image Processing and Graphics</a>. You can go and have a look at the above link for the details of the challenge and dataset (as of writing the dataset isn&rsquo;t public).</p>
<figure><a class="lightgallery" href="/images/ncvpripg23_wv.png" title="/images/ncvpripg23_wv.png" data-thumbnail="/images/ncvpripg23_wv.png" data-sub-html="<h2>Writer Verification Challenge</h2>">
        <img
            
            loading="lazy"
            src="/images/ncvpripg23_wv.png"
            srcset="/images/ncvpripg23_wv.png, /images/ncvpripg23_wv.png 1.5x, /images/ncvpripg23_wv.png 2x"
            sizes="auto"
            alt="/images/ncvpripg23_wv.png" height="500"  width="500" >
    </a><figcaption class="image-caption">Writer Verification Challenge</figcaption>
    </figure>
<p>You can also have a look at the <a href="https://github.com/cs-mshah/NCVPRIPG2023_Writer_Verification" target="_blank" rel="noopener noreferrer">project repository</a> along with this blog.</p>
<div class="details admonition abstract">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-list-ul fa-fw"></i>TL;DR<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><ul>
<li>Used a <code>ResNet50</code> with <code>DINO</code> pretrained weights.</li>
<li>Trained the network using triplet loss.</li>
<li>Final test AUC is <strong>0.97588</strong> in just 10 epochs.</li>
</ul>
</div>
        </div>
    </div>
<h2 id="exploratory-data-analysis-eda" class="headerLink">
    <a href="#exploratory-data-analysis-eda" class="header-mark"></a>Exploratory Data Analysis (EDA)</h2><p>For exploring computer vision datasets I use <a href="https://docs.voxel51.com/" target="_blank" rel="noopener noreferrer">Voxel51</a>, which is one of the coolest tools to qualitatively view your dataset. You can go ahead and read their extensively detailed documentation along with tutorials to get an idea of the power it has. Using it for this challenge was as simple as doing</p>
<p><code>pip install fiftyone</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">fiftyone</span> <span class="k">as</span> <span class="nn">fo</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">fiftyone_vis</span><span class="p">(</span><span class="n">dataset_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Create the dataset</span>
</span></span><span class="line"><span class="cl">    <span class="n">dataset</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_dir</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">dataset_dir</span><span class="o">=</span><span class="n">dataset_dir</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">dataset_type</span><span class="o">=</span><span class="n">fo</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">ImageClassificationDirectoryTree</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">session</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">launch_app</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">session</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The above code is generic enough to view any dataset organized in the standard <a href="https://pytorch.org/vision/stable/generated/torchvision.datasets.ImageFolder.html#imagefolder" target="_blank" rel="noopener noreferrer">:<code>ImageFolder</code></a> structure of <code>PyTorch</code>. The <code>session.wait()</code> is important to keep the server running. Here is the amazing visualization which we get:</p>
<figure><a class="lightgallery" href="/images/voxel51.png" title="/images/voxel51.png" data-thumbnail="/images/voxel51.png" data-sub-html="<h2>voxel51</h2>">
        <img
            
            loading="lazy"
            src="/images/voxel51.png"
            srcset="/images/voxel51.png, /images/voxel51.png 1.5x, /images/voxel51.png 2x"
            sizes="auto"
            alt="/images/voxel51.png" height="500"  width="1920" >
    </a><figcaption class="image-caption">voxel51</figcaption>
    </figure>
<p>We can clearly see the class labels and several other filters/tools in the dashboard. The images are of varying sizes and with only a few images per writer class. The written text contains English alphabets, special symbols (punctuations, superscript, digits, special chars), lines, paragraphs, 2 text boxes in one image, printed text, strikes, written text going outside the black boundary box, text written at angles and a few blank texts.</p>
<p>Although there is a lot of scope for preprocessing, I started without it to find out the initial results, which turned out to be pretty decent.</p>
<h2 id="model-architecture" class="headerLink">
    <a href="#model-architecture" class="header-mark"></a>Model Architecture</h2><p>Due to a large number of writer classes and only a few images per class, the problem can be modelled into a <strong>metric learning task</strong>, where the goal is to learn a similarity function between pairs of images. With this similarity metric, we would finally be able to predict whether two texts come from the same writer (by setting an appropriate threshold).</p>
<div class="details admonition note open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw"></i>Evaluation Metric<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">As the problem is that of binary classification, the metric for the challenge is the <a href="https://analyticsindiamag.com/complete-guide-to-understanding-roc-curves/" target="_blank" rel="noopener noreferrer">AUC score</a>.</div>
        </div>
    </div>
<p>The overall architecture consists of two things</p>
<ul>
<li>The encoder part (backbone) to encode images.</li>
<li>The loss function to train the model on.</li>
</ul>
<figure><a class="lightgallery" href="/images/wv_architecture.png" title="/images/wv_architecture.png" data-thumbnail="/images/wv_architecture.png" data-sub-html="<h2>architecture</h2>">
        <img
            
            loading="lazy"
            src="/images/wv_architecture.png"
            srcset="/images/wv_architecture.png, /images/wv_architecture.png 1.5x, /images/wv_architecture.png 2x"
            sizes="auto"
            alt="/images/wv_architecture.png" height="535"  width="990" >
    </a><figcaption class="image-caption">architecture</figcaption>
    </figure>
<h3 id="the-image-encoder" class="headerLink">
    <a href="#the-image-encoder" class="header-mark"></a>The Image Encoder</h3><p>The encoder is a simple <code>ResNet50</code> with an output dimension of <code>64</code> (instead of the default 1000). For getting a good backbone, I thought of using <a href="https://github.com/facebookresearch/dino" target="_blank" rel="noopener noreferrer">DINO</a> pretrained weights on ImageNet. Several papers have shown this backbone to be strong in downstream metric learning tasks. I just started with a <code>ResNet50</code>, but a <code>ViT</code> could&rsquo;ve been tried too, along with the more recent <a href="https://github.com/facebookresearch/dinov2" target="_blank" rel="noopener noreferrer">DINOv2</a> weights. I used a generic classifier from the <a href="https://github.com/thuml/Transfer-Learning-Library/blob/master/tllib/modules/classifier.py" target="_blank" rel="noopener noreferrer">Transfer Learning Library</a>, which can be configured to have different backbones, bottlenecks and heads. Another benefit is that the <em>learning rates</em> of different layers <em>can also be configured</em>.</p>
<h3 id="the-triplet-loss" class="headerLink">
    <a href="#the-triplet-loss" class="header-mark"></a>The Triplet Loss</h3><p>The triplet loss seemed to be one of the ideal choices to train the network on. The motivation comes from the following:</p>
<figure><a class="lightgallery" href="/1*ADu4F-SoI-cLqyO0IqqBrQ_5766171837206140609.webp" title="/1*ADu4F-SoI-cLqyO0IqqBrQ_5766171837206140609.webp" data-thumbnail="/1*ADu4F-SoI-cLqyO0IqqBrQ_5766171837206140609.webp" data-sub-html="<h2>Triplet Loss - Advanced Intro</h2>">
        <img
            
            loading="lazy"
            src="/1*ADu4F-SoI-cLqyO0IqqBrQ_5766171837206140609.webp"
            srcset="/1*ADu4F-SoI-cLqyO0IqqBrQ_5766171837206140609.webp, /1*ADu4F-SoI-cLqyO0IqqBrQ_5766171837206140609.webp 1.5x, /1*ADu4F-SoI-cLqyO0IqqBrQ_5766171837206140609.webp 2x"
            sizes="auto"
            alt="/1*ADu4F-SoI-cLqyO0IqqBrQ_5766171837206140609.webp" height="256"  width="828" >
    </a><figcaption class="image-caption"><a href="https://towardsdatascience.com/triplet-loss-advanced-intro-49a07b7d8905" target="_blank" rel="noopener noreferrer">Triplet Loss - Advanced Intro</a></figcaption>
    </figure>
<p>The loss is defined by,</p>
<div class="details admonition note open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw"></i>Loss Function<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p>$$
L(a,p,n) = max\{d(a_i, p_i)-d(a_i, n_i) + margin, 0\}
$$</p>
<p>Where,<br>
$a - \textnormal{denotes the anchor}$<br>
$p - \textnormal{denotes the positive (image from the same writer class as anchor)}$<br>
$n - \textnormal{denotes the negative (image from a different writer class as anchor)}$<br>
$d - \textnormal{distance metric (CosineSimilarty in this case)}$<br>
$\textnormal{margin }-\textnormal{ distance between (ap) and (an) pairs}$</p>
</div>
        </div>
    </div>
<div class="details admonition tip open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-lightbulb fa-fw"></i>pytorch-metric-learning<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">For implementing losses, miners and samplers, I used the state of the art <a href="https://github.com/KevinMusgrave/pytorch-metric-learning" target="_blank" rel="noopener noreferrer">pytorch-metric-learning</a> library.</div>
        </div>
    </div>
<p>Triplets are mined by a $\verb|TripletMarginMiner|$ function depending on <a href="https://kevinmusgrave.github.io/pytorch-metric-learning/miners/%5c#tripletmarginminer" target="_blank" rel="noopener noreferrer">specific conditions</a>. I kept the margin as <strong>0.2</strong> (could&rsquo;ve been a hyperparameter) in all experiments.</p>
<h3 id="training" class="headerLink">
    <a href="#training" class="header-mark"></a>Training</h3><p>A learning rate of <strong>0.01</strong> was used for the head <em>(fc layer)</em>, <strong>0.001</strong> was used for the backbone, along with <em>adam</em> as the optimizer and an exponentially decaying $lr$ scheduler.<br>
The $lr$ decays every epoch according to,</p>
<p>$$lr = lr_0(1 + 0.001lr)^{-0.75}$$
The choice of hyperparameters in this case is purely based on some past experience with using the <code>Transfer-Learning-Library</code>.</p>
<div class="details admonition note open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw"></i>MPerClassSampler<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">Instead of the standard <a href="https://pytorch.org/docs/stable/data.html#torch.utils.data.RandomSampler" target="_blank" rel="noopener noreferrer"><code>RandomSampler</code></a> for sampling images of a batch, I made use of an <a href="https://kevinmusgrave.github.io/pytorch-metric-learning/samplers/#mperclasssampler" target="_blank" rel="noopener noreferrer">:<code>MPerClassSampler</code></a> from the <code>pytorch-metric-learning</code> library, which samples $M=4$ images of every class in a batch. The benefit of doing this is a <strong>much</strong> faster convergence due to the production of a large number of triplets in a batch, making it more useful than random sampling.</div>
        </div>
    </div>
<div class="details admonition success open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-check-circle fa-fw"></i>weights and biases logs<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">The entire training logs of all experiments can be found at: <a href="https://wandb.ai/manan-shah/NCVPRIPG23-Writer-Verification?workspace=user-manan-shah" target="_blank" rel="noopener noreferrer">wandb</a></div>
        </div>
    </div>
<div class="details admonition success">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-check-circle fa-fw"></i>Training plots of the best model<i class="details-icon fas fa-angle-right fa-fw"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><figure><a class="lightgallery" href="/6fEOyWh_11139380070564900249.png" title="/6fEOyWh_11139380070564900249.png" data-thumbnail="/6fEOyWh_11139380070564900249.png">
        <img
            
            loading="lazy"
            src="/6fEOyWh_11139380070564900249.png"
            srcset="/6fEOyWh_11139380070564900249.png, /6fEOyWh_11139380070564900249.png 1.5x, /6fEOyWh_11139380070564900249.png 2x"
            sizes="auto"
            alt="/6fEOyWh_11139380070564900249.png" height="364"  width="1065" >
    </a></figure></div>
        </div>
    </div>
<h2 id="results-and-conclusions" class="headerLink">
    <a href="#results-and-conclusions" class="header-mark"></a>Results and Conclusions</h2><p>Here is an overview of some of the ablations that were conducted.</p>
<table>
<thead>
<tr>
<th style="text-align:left">AUC (Val)</th>
<th style="text-align:left">Batch Size</th>
<th style="text-align:left">Miner</th>
<th style="text-align:left">Sampler</th>
<th style="text-align:left">Epochs</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0.7217</td>
<td style="text-align:left">32</td>
<td style="text-align:left">semihard</td>
<td style="text-align:left">-</td>
<td style="text-align:left">20</td>
</tr>
<tr>
<td style="text-align:left">0.9642</td>
<td style="text-align:left">128</td>
<td style="text-align:left">semihard</td>
<td style="text-align:left">-</td>
<td style="text-align:left">80</td>
</tr>
<tr>
<td style="text-align:left">0.9782</td>
<td style="text-align:left">128</td>
<td style="text-align:left">all</td>
<td style="text-align:left">-</td>
<td style="text-align:left">80</td>
</tr>
<tr>
<td style="text-align:left">0.9775</td>
<td style="text-align:left">128</td>
<td style="text-align:left">all</td>
<td style="text-align:left">MPerClass</td>
<td style="text-align:left">10</td>
</tr>
</tbody>
</table>
<ul>
<li>It is clear from the table that one needs a larger batch size (which is obvious in metric learning tasks).</li>
<li><code>all</code> mining strategy generates more triplets, and this strategy works slightly better than the other options. <code>hard</code> mining resulted in the loss to collapse and ultimately halt training, due to a decrease in the triplets mined after a few epochs.</li>
<li>An <code>MPerClassSampler</code> greatly improves training time.</li>
<li>The AUC of the best model on the <code>val</code> set turned out to be <strong>0.9775</strong> and that of the test set turned out to be <strong>0.97588</strong></li>
</ul>
<p>Overall, it was an amazing experience for me to <strong>win</strong> my <strong>first</strong> challenge.</p></div>

        

<div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 25-07-2023</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span><a class="link-to-mardown" href=/ncvpripg23_writer_verification/index.md target="_blank" rel="noopener noreferrer">Read markdown</a>
                    </span></div>
            <div class="post-info-share"><button title="Share on Twitter" data-sharer="twitter" data-url="https://cs-mshah.github.io/ncvpripg23_writer_verification/" data-title="Winning the NCVPRIPG23 Challenge on Writer Verification" data-via="cs_mshah" data-hashtags="CV"><span class="fab fa-twitter fa-fw"></span></button><button title="Share on Facebook" data-sharer="facebook" data-url="https://cs-mshah.github.io/ncvpripg23_writer_verification/" data-hashtag="CV"><span class="fab fa-facebook-square fa-fw"></span></button><button title="Share on Linkedin" data-sharer="linkedin" data-url="https://cs-mshah.github.io/ncvpripg23_writer_verification/"><span class="fab fa-linkedin fa-fw"></span></button><button title="Share on WhatsApp" data-sharer="whatsapp" data-url="https://cs-mshah.github.io/ncvpripg23_writer_verification/" data-title="Winning the NCVPRIPG23 Challenge on Writer Verification" data-web><span class="fab fa-whatsapp fa-fw"></span></button><button title="Share on Hacker News" data-sharer="hackernews" data-url="https://cs-mshah.github.io/ncvpripg23_writer_verification/" data-title="Winning the NCVPRIPG23 Challenge on Writer Verification"><span class="fab fa-hacker-news fa-fw"></span></button><button title="Share on Telegram" data-sharer="telegram" data-url="https://cs-mshah.github.io/ncvpripg23_writer_verification/" data-title="Winning the NCVPRIPG23 Challenge on Writer Verification" data-web><span class="fab fa-telegram-plane fa-fw"></span></button></div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/cv/">CV</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/cs161_computer_security_notes/" class="prev" rel="prev" title="Notes from CS161: Computer Security"><i class="fas fa-angle-left fa-fw"></i>Notes from CS161: Computer Security</a></div>
</div>
<div id="comments"><div id="utterances"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://utteranc.es/">Utterances</a>.
            </noscript></div></article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2021 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://github.com/cs-mshah" target="_blank" rel="noopener noreferrer">Manan</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
            <div class="footer-line"></div>
            <div class="footer-line">
            </div>
        </div></footer></div>

    <div id="fixed-buttons"><a href="#back-to-top" id="back-to-top-button" class="fixed-button" title="Back to Top">
            <i class="fas fa-arrow-up fa-fw"></i>
        </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
            <i class="fas fa-comment fa-fw"></i>
        </a>
    </div><div class="assets"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/katex/copy-tex.min.css">
        <noscript><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"></noscript><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":20},"comment":{"utterances":{"darkTheme":"github-dark","issueTerm":"pathname","label":"","lightTheme":"github-light","repo":"cs-mshah/cs-mshah.github.io"}},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"distance":100,"findAllMatches":false,"fuseIndexURL":"/index.json","highlightTag":"em","ignoreFieldNorm":false,"ignoreLocation":true,"isCaseSensitive":false,"location":0,"maxResultLength":10,"minMatchCharLength":2,"noResultsFound":"No results found","snippetLength":300,"threshold":0.1,"type":"fuse","useExtendedSearch":false},"sharerjs":true,"table":{"sort":true},"twemoji":true};</script><script type="text/javascript" src="/lib/tablesort/tablesort.min.js"></script><script type="text/javascript" src="/lib/twemoji/twemoji.min.js" defer></script><script type="text/javascript" src="/js/twemoji.min.js" defer></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js" defer></script><script type="text/javascript" src="/lib/katex/auto-render.min.js" defer></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js" defer></script><script type="text/javascript" src="/lib/katex/mhchem.min.js" defer></script><script type="text/javascript" src="/js/katex.min.js" defer></script><script type="text/javascript" src="/js/theme.min.js" defer></script><script type="text/javascript" src="/js/utterances.min.js" defer></script><script src="https://cdn.jsdelivr.net/gh/ncase/nutshell/nutshell.js"> </script>
    <script>
        Nutshell.setOptions({
            startOnLoad: true, 
            lang: 'en', 
            dontEmbedHeadings: true 
        });
    </script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'G-BC120QQNGQ', { 'anonymize_ip': true });
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-BC120QQNGQ" async></script></div>
</body>

</html>